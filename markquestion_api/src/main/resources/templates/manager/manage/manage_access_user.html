<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>管理访客ip</title>
    <div th:include="manager/manageCommon/js_css :: js_css"></div>
</head>
<body>
<div class="ui grid">
    <!--导航-->
    <div class="row" th:include="manager/manageCommon/nav :: manageNav">
    </div>

    <!--主体-->
    <div class="row">
        <div class="two wide column"></div>
        <div class="twelve wide column">

            <a id="getHundredAccess" class="ui button">显示最近100次访问记录</a>
            <a id="getAllAccess" class="ui button">显示所有访问过的ip</a>

            <table class="ui celled table">
                <thead>
                <tr>
                    <th>id</th>
                    <th>ip</th>
                    <th>地理位置</th>
                    <th>访问时间</th>
                    <th>访问次数</th>
                </tr>
                </thead>
                <tbody id="body">
                <tr>
                    <td></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    //用于格式化时间的函数
    function timeString(time){
        let datetime = new Date();
        datetime.setTime(time);
        let year = datetime.getFullYear();
        let month = datetime.getMonth() + 1 < 10 ? "0" + (datetime.getMonth() + 1) : datetime.getMonth() + 1;
        let date = datetime.getDate() < 10 ? "0" + datetime.getDate() : datetime.getDate();
        let hour = datetime.getHours()< 10 ? "0" + datetime.getHours() : datetime.getHours();
        let minute = datetime.getMinutes()< 10 ? "0" + datetime.getMinutes() : datetime.getMinutes();
        let second = datetime.getSeconds()< 10 ? "0" + datetime.getSeconds() : datetime.getSeconds();
        return year + "-" + month + "-" + date+" "+hour+":"+minute+":"+second;
    }

    $("#getHundredAccess").click(function () {
        $.ajax({
            url:"/manage/access/getHundredAccess",
            type:"GET",
            success:function(args){
                let accessLogs = JSON.parse(args);

                let body = $("#body");
                body.empty();

                for(let index in accessLogs){
                    let accessLog = accessLogs[index];

                    let tr = document.createElement("tr");

                    let id = document.createElement("td");
                    id.append(document.createTextNode(accessLog.id));

                    let ip = document.createElement("td");
                    ip.append(document.createTextNode(accessLog.ip));

                    let address = document.createElement("td");
                    address.append(document.createTextNode(accessLog.address));

                    let watchTime = document.createElement("td");
                    watchTime.append(document.createTextNode(timeString(accessLog.watchTime)));

                    let watchNum = document.createElement("td");

                    tr.append(id);
                    tr.append(ip);
                    tr.append(address);
                    tr.append(watchTime);
                    tr.append(watchNum);

                    body.append(tr);
                }

            },
            error:function(){

            }
        })
    })

    $("#getAllAccess").click(function(){
        $.ajax({
            url:"/manage/access/getAllAccess",
            type:"GET",
            success:function(args){
                let accessMessages = JSON.parse(args);

                let body = $("#body");
                body.empty();

                for(let index in accessMessages){
                    let accessMessage = accessMessages[index];

                    let tr = document.createElement("tr");

                    let id = document.createElement("td");
                    id.append(document.createTextNode(accessMessage.id));

                    let ip = document.createElement("td");
                    ip.append(document.createTextNode(accessMessage.ip));

                    let address = document.createElement("td");
                    address.append(document.createTextNode(accessMessage.address));

                    let watchTime = document.createElement("td");


                    let watchNum = document.createElement("td");
                    watchNum.append(document.createTextNode(accessMessage.number));

                    tr.append(id);
                    tr.append(ip);
                    tr.append(address);
                    tr.append(watchTime);
                    tr.append(watchNum);

                    body.append(tr);
                }

            },
            error:function(){

            }
        })
    })

    $(function(){
        $("#manageAccess").attr("class","item active");
    })
</script>
</body>
</html>